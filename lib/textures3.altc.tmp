require 'util'
require 'global'
require 'user_instruction'
require 'composer'
module Aleatoric

# Declare Variables #

_midi_max=127
_pi_rng=10
_pi_rng_hlf=157
_pi_rng_fth=63
_pi_rng_tnth=31
_pi_rng_f=314.0
_pi_fctr=100.0
_midi_min=0
_loops_factor=1

_blen=0.05
_blenrst=0.005
_ampfctr=0.4

def cycle(index)
Math.sin(index%10 / 100.0)

end
def cocycle(index)
Math.cos(index%157 / 100.0)

# Offsets a value within a range
# swing(0.98,5,0.01)==> 0.98-1.02
end
def swing(base_val,num_steps,swing_step)
base_val+(rand(num_steps)*swing_step)

end
def midi_rng(index)
index%127

end
def rise(index)
if index <=127
index%127
else
127
end

end
def dampen(index,fctr)
(Math.log10(index+1))*fctr


end

format midi

breakpoint

repeat 10 do|index|
end
phrase "p1" do
note "n11" do
channel 0
instrument MIDI_Violin

duration(dampen(index,1.0))

amplitude(rise(index))
pitch C6
end
note "n12r" do
channel 0
instrument MIDI_Violin
duration 0.005*(dampen(index,1.0))
velocity 0
pitch Aneg1

end
end
render "..\\compositions\\textures3.mid" do
phrases "p1"
end


end
